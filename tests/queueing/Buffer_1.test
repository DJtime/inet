%description:

In this test, packets are produced periodically (randomly) by two active packet
sources (ActivePacketSource). The packets are collected periodically (randomly)
by two active packet sinks (ActivePacketSink). The sources and the sinkes are
connected by packet queues (TestQueue) and packets are stored in shared packet
buffer (PacketBuffer). The packet buffer drops packets from the beginning of
the buffer when it gets overloaded.

%file: test.ned

import inet.queueing.buffer.PacketBuffer;
import inet.queueing.classifier.PacketClassifier;
import inet.queueing.queue.CompoundPacketQueueBase;
import inet.queueing.queue.PacketQueue;
import inet.queueing.sink.ActivePacketSink;
import inet.queueing.source.ActivePacketSource;
import inet.queueing.scheduler.PriorityScheduler;

network TestBufferNetwork
{
    submodules:
        buffer: PacketBuffer {
            @display("p=100,300");
        }
        producer1: ActivePacketSource {
            @display("p=100,100");
        }
        producer2: ActivePacketSource {
            @display("p=100,200");
        }
        queue1: PacketQueue {
            @display("p=300,100");
        }
        queue2: PacketQueue {
            @display("p=300,200");
        }
        collector1: ActivePacketSink {
            @display("p=500,100");
        }
        collector2: ActivePacketSink {
            @display("p=500,200");
        }
    connections:
        producer1.out --> queue1.in;
        queue1.out --> collector1.in;
        producer2.out --> queue2.in;
        queue2.out --> collector2.in;
}

%inifile: omnetpp.ini

[General]
network = TestBufferNetwork
sim-time-limit = 10s
cmdenv-event-banners = false
cmdenv-log-prefix = "At %ts %N: "
*.buffer.dropperClass = "inet::queueing::PacketAtCollectionBeginDropper"
*.producer*.packetLength = 1B
*.producer*.productionInterval = uniform(0s, 1s)
*.collector*.collectionInterval = uniform(0s, 2s)
*.queue*.bufferModule = "^.buffer"
*.buffer.packetCapacity = 2

%# remove formatting
%subst: /\x1B\[[0-9;]*m//

%subst: /\nRunning simulation\.\.\.\n//

%contains-regex: stdout
At 0s producer1: Producing packet, .*?producer1-0.*?
At 0s queue1: Pushing packet, .*?producer1-0.*?
At 0s buffer: Adding packet, .*?producer1-0.*?
At 0s queue1: Pulling packet, .*?producer1-0.*?
At 0s buffer: Removing packet, .*?producer1-0.*?
At 0s collector1: Collecting packet, .*?producer1-0.*?
At 0s producer2: Producing packet, .*?producer2-0.*?
At 0s queue2: Pushing packet, .*?producer2-0.*?
At [^\n]*?: Adding packet, .*?producer2-0.*?
At [^\n]*?: Pulling packet, .*?producer2-0.*?
At [^\n]*?: Removing packet, .*?producer2-0.*?
At [^\n]*?: Collecting packet, .*?producer2-0.*?
At [^\n]*?: Producing packet, .*?producer1-1.*?
At [^\n]*?: Pushing packet, .*?producer1-1.*?
At [^\n]*?: Adding packet, .*?producer1-1.*?
At [^\n]*?: Producing packet, .*?producer2-1.*?
At [^\n]*?: Pushing packet, .*?producer2-1.*?
At [^\n]*?: Adding packet, .*?producer2-1.*?
At [^\n]*?: Producing packet, .*?producer1-2.*?
At [^\n]*?: Pushing packet, .*?producer1-2.*?
At [^\n]*?: Adding packet, .*?producer1-2.*?
At [^\n]*?: Dropping packet, .*?producer1-1.*?
At [^\n]*?: Removing packet, .*?producer1-1.*?
At [^\n]*?: Pulling packet, .*?producer1-2.*?
At [^\n]*?: Removing packet, .*?producer1-2.*?
At [^\n]*?: Collecting packet, .*?producer1-2.*?
At [^\n]*?: Producing packet, .*?producer2-2.*?
At [^\n]*?: Pushing packet, .*?producer2-2.*?
At [^\n]*?: Adding packet, .*?producer2-2.*?
At [^\n]*?: Pulling packet, .*?producer2-1.*?
At [^\n]*?: Removing packet, .*?producer2-1.*?
At [^\n]*?: Collecting packet, .*?producer2-1.*?
At [^\n]*?: Producing packet, .*?producer1-3.*?
At [^\n]*?: Pushing packet, .*?producer1-3.*?
At [^\n]*?: Adding packet, .*?producer1-3.*?
At [^\n]*?: Producing packet, .*?producer2-3.*?
At [^\n]*?: Pushing packet, .*?producer2-3.*?
At [^\n]*?: Adding packet, .*?producer2-3.*?
At [^\n]*?: Dropping packet, .*?producer2-2.*?
At [^\n]*?: Removing packet, .*?producer2-2.*?
At [^\n]*?: Producing packet, .*?producer1-4.*?
At [^\n]*?: Pushing packet, .*?producer1-4.*?
At [^\n]*?: Adding packet, .*?producer1-4.*?
At [^\n]*?: Dropping packet, .*?producer1-3.*?
At [^\n]*?: Removing packet, .*?producer1-3.*?
At [^\n]*?: Producing packet, .*?producer2-4.*?
At [^\n]*?: Pushing packet, .*?producer2-4.*?
At [^\n]*?: Adding packet, .*?producer2-4.*?
At [^\n]*?: Dropping packet, .*?producer2-3.*?
At [^\n]*?: Removing packet, .*?producer2-3.*?
At [^\n]*?: Producing packet, .*?producer2-5.*?
At [^\n]*?: Pushing packet, .*?producer2-5.*?
At [^\n]*?: Adding packet, .*?producer2-5.*?
At [^\n]*?: Dropping packet, .*?producer1-4.*?
At [^\n]*?: Removing packet, .*?producer1-4.*?
At [^\n]*?: Producing packet, .*?producer1-5.*?
At [^\n]*?: Pushing packet, .*?producer1-5.*?
At [^\n]*?: Adding packet, .*?producer1-5.*?
At [^\n]*?: Dropping packet, .*?producer2-4.*?
At [^\n]*?: Removing packet, .*?producer2-4.*?
At [^\n]*?: Producing packet, .*?producer1-6.*?
At [^\n]*?: Pushing packet, .*?producer1-6.*?
At [^\n]*?: Adding packet, .*?producer1-6.*?
At [^\n]*?: Dropping packet, .*?producer2-5.*?
At [^\n]*?: Removing packet, .*?producer2-5.*?
At [^\n]*?: Pulling packet, .*?producer1-5.*?
At [^\n]*?: Removing packet, .*?producer1-5.*?
At [^\n]*?: Collecting packet, .*?producer1-5.*?
At [^\n]*?: Pulling packet, .*?producer1-6.*?
At [^\n]*?: Removing packet, .*?producer1-6.*?
At [^\n]*?: Collecting packet, .*?producer1-6.*?
At [^\n]*?: Producing packet, .*?producer2-6.*?
At [^\n]*?: Pushing packet, .*?producer2-6.*?
At [^\n]*?: Adding packet, .*?producer2-6.*?
At [^\n]*?: Pulling packet, .*?producer2-6.*?
At [^\n]*?: Removing packet, .*?producer2-6.*?
At [^\n]*?: Collecting packet, .*?producer2-6.*?
At [^\n]*?: Producing packet, .*?producer1-7.*?
At [^\n]*?: Pushing packet, .*?producer1-7.*?
At [^\n]*?: Adding packet, .*?producer1-7.*?
At [^\n]*?: Producing packet, .*?producer2-7.*?
At [^\n]*?: Pushing packet, .*?producer2-7.*?
At [^\n]*?: Adding packet, .*?producer2-7.*?
At [^\n]*?: Pulling packet, .*?producer1-7.*?
At [^\n]*?: Removing packet, .*?producer1-7.*?
At [^\n]*?: Collecting packet, .*?producer1-7.*?
At [^\n]*?: Producing packet, .*?producer2-8.*?
At [^\n]*?: Pushing packet, .*?producer2-8.*?
At [^\n]*?: Adding packet, .*?producer2-8.*?
At [^\n]*?: Producing packet, .*?producer1-8.*?
At [^\n]*?: Pushing packet, .*?producer1-8.*?
At [^\n]*?: Adding packet, .*?producer1-8.*?
At [^\n]*?: Dropping packet, .*?producer2-7.*?
At [^\n]*?: Removing packet, .*?producer2-7.*?
At [^\n]*?: Producing packet, .*?producer1-9.*?
At [^\n]*?: Pushing packet, .*?producer1-9.*?
At [^\n]*?: Adding packet, .*?producer1-9.*?
At [^\n]*?: Dropping packet, .*?producer2-8.*?
At [^\n]*?: Removing packet, .*?producer2-8.*?
At [^\n]*?: Producing packet, .*?producer2-9.*?
At [^\n]*?: Pushing packet, .*?producer2-9.*?
At [^\n]*?: Adding packet, .*?producer2-9.*?
At [^\n]*?: Dropping packet, .*?producer1-8.*?
At [^\n]*?: Removing packet, .*?producer1-8.*?
At [^\n]*?: Pulling packet, .*?producer1-9.*?
At [^\n]*?: Removing packet, .*?producer1-9.*?
At [^\n]*?: Collecting packet, .*?producer1-9.*?
At [^\n]*?: Pulling packet, .*?producer2-9.*?
At [^\n]*?: Removing packet, .*?producer2-9.*?
At [^\n]*?: Collecting packet, .*?producer2-9.*?
At [^\n]*?: Producing packet, .*?producer1-10.*?
At [^\n]*?: Pushing packet, .*?producer1-10.*?
At [^\n]*?: Adding packet, .*?producer1-10.*?
At [^\n]*?: Pulling packet, .*?producer1-10.*?
At [^\n]*?: Removing packet, .*?producer1-10.*?
At [^\n]*?: Collecting packet, .*?producer1-10.*?
At [^\n]*?: Producing packet, .*?producer2-10.*?
At [^\n]*?: Pushing packet, .*?producer2-10.*?
At [^\n]*?: Adding packet, .*?producer2-10.*?
At [^\n]*?: Pulling packet, .*?producer2-10.*?
At [^\n]*?: Removing packet, .*?producer2-10.*?
At [^\n]*?: Collecting packet, .*?producer2-10.*?
At [^\n]*?: Producing packet, .*?producer2-11.*?
At [^\n]*?: Pushing packet, .*?producer2-11.*?
At [^\n]*?: Adding packet, .*?producer2-11.*?
At [^\n]*?: Producing packet, .*?producer1-11.*?
At [^\n]*?: Pushing packet, .*?producer1-11.*?
At [^\n]*?: Adding packet, .*?producer1-11.*?
At [^\n]*?: Pulling packet, .*?producer2-11.*?
At [^\n]*?: Removing packet, .*?producer2-11.*?
At [^\n]*?: Collecting packet, .*?producer2-11.*?
At [^\n]*?: Producing packet, .*?producer2-12.*?
At [^\n]*?: Pushing packet, .*?producer2-12.*?
At [^\n]*?: Adding packet, .*?producer2-12.*?
At [^\n]*?: Producing packet, .*?producer2-13.*?
At [^\n]*?: Pushing packet, .*?producer2-13.*?
At [^\n]*?: Adding packet, .*?producer2-13.*?
At [^\n]*?: Dropping packet, .*?producer1-11.*?
At [^\n]*?: Removing packet, .*?producer1-11.*?
At [^\n]*?: Producing packet, .*?producer1-12.*?
At [^\n]*?: Pushing packet, .*?producer1-12.*?
At [^\n]*?: Adding packet, .*?producer1-12.*?
At [^\n]*?: Dropping packet, .*?producer2-12.*?
At [^\n]*?: Removing packet, .*?producer2-12.*?
At [^\n]*?: Pulling packet, .*?producer1-12.*?
At [^\n]*?: Removing packet, .*?producer1-12.*?
At [^\n]*?: Collecting packet, .*?producer1-12.*?
At [^\n]*?: Producing packet, .*?producer2-14.*?
At [^\n]*?: Pushing packet, .*?producer2-14.*?
At [^\n]*?: Adding packet, .*?producer2-14.*?
At [^\n]*?: Producing packet, .*?producer1-13.*?
At [^\n]*?: Pushing packet, .*?producer1-13.*?
At [^\n]*?: Adding packet, .*?producer1-13.*?
At [^\n]*?: Dropping packet, .*?producer2-13.*?
At [^\n]*?: Removing packet, .*?producer2-13.*?
At [^\n]*?: Pulling packet, .*?producer2-14.*?
At [^\n]*?: Removing packet, .*?producer2-14.*?
At [^\n]*?: Collecting packet, .*?producer2-14.*?
At [^\n]*?: Producing packet, .*?producer2-15.*?
At [^\n]*?: Pushing packet, .*?producer2-15.*?
At [^\n]*?: Adding packet, .*?producer2-15.*?
At [^\n]*?: Producing packet, .*?producer1-14.*?
At [^\n]*?: Pushing packet, .*?producer1-14.*?
At [^\n]*?: Adding packet, .*?producer1-14.*?
At [^\n]*?: Dropping packet, .*?producer1-13.*?
At [^\n]*?: Removing packet, .*?producer1-13.*?
At [^\n]*?: Producing packet, .*?producer2-16.*?
At [^\n]*?: Pushing packet, .*?producer2-16.*?
At [^\n]*?: Adding packet, .*?producer2-16.*?
At [^\n]*?: Dropping packet, .*?producer2-15.*?
At [^\n]*?: Removing packet, .*?producer2-15.*?
At [^\n]*?: Producing packet, .*?producer1-15.*?
At [^\n]*?: Pushing packet, .*?producer1-15.*?
At [^\n]*?: Adding packet, .*?producer1-15.*?
At [^\n]*?: Dropping packet, .*?producer1-14.*?
At [^\n]*?: Removing packet, .*?producer1-14.*?
At [^\n]*?: Pulling packet, .*?producer1-15.*?
At [^\n]*?: Removing packet, .*?producer1-15.*?
At [^\n]*?: Collecting packet, .*?producer1-15.*?
At [^\n]*?: Producing packet, .*?producer2-17.*?
At [^\n]*?: Pushing packet, .*?producer2-17.*?
At [^\n]*?: Adding packet, .*?producer2-17.*?
At [^\n]*?: Producing packet, .*?producer1-16.*?
At [^\n]*?: Pushing packet, .*?producer1-16.*?
At [^\n]*?: Adding packet, .*?producer1-16.*?
At [^\n]*?: Dropping packet, .*?producer2-16.*?
At [^\n]*?: Removing packet, .*?producer2-16.*?
At [^\n]*?: Pulling packet, .*?producer1-16.*?
At [^\n]*?: Removing packet, .*?producer1-16.*?
At [^\n]*?: Collecting packet, .*?producer1-16.*?
At [^\n]*?: Pulling packet, .*?producer2-17.*?
At [^\n]*?: Removing packet, .*?producer2-17.*?
At [^\n]*?: Collecting packet, .*?producer2-17.*?
