%description:

In this test, packets are produced periodically (randomly) by two active packet
sources (ActivePacketSource). The packets are collected periodically (randomly)
by two active packet sinks (ActivePacketSink). The sources and the sinkes are
connected by packet queues (TestQueue) and packets are stored in shared packet
buffer (PacketBuffer). The packet buffer drops packets when it gets overloaded
prioritizing over the packet queues.

%file: test.ned

import inet.queueing.buffer.PriorityBuffer;
import inet.queueing.classifier.PacketClassifier;
import inet.queueing.queue.CompoundPacketQueueBase;
import inet.queueing.queue.PacketQueue;
import inet.queueing.sink.ActivePacketSink;
import inet.queueing.source.ActivePacketSource;
import inet.queueing.scheduler.PriorityScheduler;

network TestBufferNetwork
{
    submodules:
        buffer: PriorityBuffer {
            @display("p=100,300");
        }
        producer1: ActivePacketSource {
            @display("p=100,100");
        }
        producer2: ActivePacketSource {
            @display("p=100,200");
        }
        queue1: PacketQueue {
            @display("p=300,100");
        }
        queue2: PacketQueue {
            @display("p=300,200");
        }
        collector1: ActivePacketSink {
            @display("p=500,100");
        }
        collector2: ActivePacketSink {
            @display("p=500,200");
        }
    connections:
        producer1.out --> queue1.in;
        queue1.out --> collector1.in;
        producer2.out --> queue2.in;
        queue2.out --> collector2.in;
}

%inifile: omnetpp.ini

[General]
network = TestBufferNetwork
sim-time-limit = 10s
cmdenv-event-banners = false
cmdenv-log-prefix = "At %ts %N: "
*.producer*.packetLength = 1B
*.producer*.productionInterval = uniform(0s, 1s)
*.collector*.collectionInterval = uniform(0s, 2s)
*.queue*.bufferModule = "^.buffer"
*.buffer.packetCapacity = 2

%# remove formatting
%subst: /\x1B\[[0-9;]*m//

%subst: /\nRunning simulation\.\.\.\n//

%contains-regex: stdout
At [^\n]*?: Producing packet, [^\n]*?producer1-0[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-0[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-0[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer1-0[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-0[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer1-0[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-0[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-0[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-0[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer2-0[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-0[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer2-0[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-1[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-1[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-1[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-1[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-1[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-1[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-2[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-2[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-2[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-1[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-1[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer1-1[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-1[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer1-1[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-2[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-2[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-2[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer2-2[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-2[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer2-2[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-3[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-3[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-3[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-3[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-3[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-3[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-3[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-3[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-4[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-4[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-4[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer1-2[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-2[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-4[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-4[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-4[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-4[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-4[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-5[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-5[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-5[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-5[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-5[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-5[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-5[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-5[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer1-3[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-3[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-6[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-6[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-6[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer1-4[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-4[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer1-5[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-5[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer1-5[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer1-6[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-6[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer1-6[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-6[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-6[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-6[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer2-6[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-6[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer2-6[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-7[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-7[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-7[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-7[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-7[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-7[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer1-7[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-7[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer1-7[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-8[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-8[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-8[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-8[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-8[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-8[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-7[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-7[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-9[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-9[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-9[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-8[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-8[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-9[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-9[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-9[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-9[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-9[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer1-8[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-8[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer1-8[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer1-9[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-9[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer1-9[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-10[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-10[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-10[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer1-10[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-10[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer1-10[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-10[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-10[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-10[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer2-10[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-10[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer2-10[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-11[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-11[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-11[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-11[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-11[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-11[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer2-11[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-11[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer2-11[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-12[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-12[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-12[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-13[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-13[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-13[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-12[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-12[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-12[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-12[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-12[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-13[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-13[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer1-11[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-11[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer1-11[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-14[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-14[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-14[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-13[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-13[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-13[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-14[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-14[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-15[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-15[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-15[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-15[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-15[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-14[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-14[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-14[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer1-12[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-12[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-15[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-15[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-15[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer1-13[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-13[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-16[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-16[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-16[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-16[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-16[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?producer1-14[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-14[^\n]*?
At [^\n]*?: Collecting packet, [^\n]*?producer1-14[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-16[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-16[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-16[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer1-17[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer1-17[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer1-17[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer1-15[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer1-15[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?producer2-17[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?producer2-17[^\n]*?
At [^\n]*?: Adding packet, [^\n]*?producer2-17[^\n]*?
At [^\n]*?: Dropping packet, [^\n]*?producer2-17[^\n]*?
At [^\n]*?: Removing packet, [^\n]*?producer2-17[^\n]*?
