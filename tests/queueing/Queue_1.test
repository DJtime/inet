%description:

In this test, packets are produced periodically (randomly) by an active packet
source (ActivePacketSource). The packets are collected periodically (randomly) by
an active packet sink (ActivePacketSink). The source and the sink is connected
by a FIFO queue (PacketQueue) where packets are stored temporarily.

%file: test.ned

import inet.queueing.source.ActivePacketSource;
import inet.queueing.sink.ActivePacketSink;
import inet.queueing.queue.PacketQueue;

network TestPacketQueue
{
    submodules:
        producer: ActivePacketSource {
            @display("p=100,100");
        }
        queue: PacketQueue {
            @display("p=200,100");
        }
        collector: ActivePacketSink {
            @display("p=300,100");
        }
    connections allowunconnected:
        producer.out --> queue.in;
        queue.out --> collector.in;
}

%inifile: omnetpp.ini

[General]
network = TestPacketQueue
sim-time-limit = 10s
cmdenv-event-banners = false
cmdenv-log-prefix = "At %ts %N: "
*.producer.packetLength = 1B
*.producer.productionInterval = uniform(0s, 2s)
*.collector.collectionInterval = uniform(0s, 2s)

%# remove formatting
%subst: /\x1B\[[0-9;]*m//

%subst: /\nRunning simulation\.\.\.\n//

%contains-regex: stdout
At [^\n]*?: Producing packet, .*?producer-0.*?
At [^\n]*?: Pushing packet, .*?producer-0.*?
At [^\n]*?: Pulling packet, .*?producer-0.*?
At [^\n]*?: Collecting packet, .*?producer-0.*?
At [^\n]*?: Producing packet, .*?producer-1.*?
At [^\n]*?: Pushing packet, .*?producer-1.*?
At [^\n]*?: Pulling packet, .*?producer-1.*?
At [^\n]*?: Collecting packet, .*?producer-1.*?
At [^\n]*?: Producing packet, .*?producer-2.*?
At [^\n]*?: Pushing packet, .*?producer-2.*?
At [^\n]*?: Pulling packet, .*?producer-2.*?
At [^\n]*?: Collecting packet, .*?producer-2.*?
At [^\n]*?: Producing packet, .*?producer-3.*?
At [^\n]*?: Pushing packet, .*?producer-3.*?
At [^\n]*?: Pulling packet, .*?producer-3.*?
At [^\n]*?: Collecting packet, .*?producer-3.*?
At [^\n]*?: Producing packet, .*?producer-4.*?
At [^\n]*?: Pushing packet, .*?producer-4.*?
At [^\n]*?: Producing packet, .*?producer-5.*?
At [^\n]*?: Pushing packet, .*?producer-5.*?
At [^\n]*?: Pulling packet, .*?producer-4.*?
At [^\n]*?: Collecting packet, .*?producer-4.*?
At [^\n]*?: Producing packet, .*?producer-6.*?
At [^\n]*?: Pushing packet, .*?producer-6.*?
At [^\n]*?: Pulling packet, .*?producer-5.*?
At [^\n]*?: Collecting packet, .*?producer-5.*?
At [^\n]*?: Producing packet, .*?producer-7.*?
At [^\n]*?: Pushing packet, .*?producer-7.*?
At [^\n]*?: Producing packet, .*?producer-8.*?
At [^\n]*?: Pushing packet, .*?producer-8.*?
At [^\n]*?: Pulling packet, .*?producer-6.*?
At [^\n]*?: Collecting packet, .*?producer-6.*?
At [^\n]*?: Pulling packet, .*?producer-7.*?
At [^\n]*?: Collecting packet, .*?producer-7.*?
