%description:

TODO

%file: test.ned

import inet.queueing.sink.PassivePacketSink;
import inet.queueing.common.PacketDelayer;
import inet.queueing.source.ActivePacketSource;
import inet.queueing.queue.PacketQueue;
import inet.queueing.server.PacketServer;

module TestMac
{
    gates:
        input lowerIn;
        input upperIn;
        output lowerOut;
        output upperOut;
    submodules:
        queue: PacketQueue;
        server: PacketServer;
    connections:
        upperIn --> queue.in;
        queue.out --> server.in;
        server.out --> lowerOut;
        lowerIn --> upperOut;
}

module TestHost
{
    gates:
        input lowerIn;
        output lowerOut;
    submodules:
        sourceApplication: ActivePacketSource;
        destinationApplication: PassivePacketSink;
        mac: TestMac;
    connections:
    	sourceApplication.out --> mac.upperIn;
    	mac.lowerOut --> lowerOut;
        lowerIn --> mac.lowerIn;
    	mac.upperOut --> destinationApplication.in;
}

module TestCable
{
    gates:
        input aIn;
        output aOut;
        input bIn;
        output bOut;
    submodules:
        aDelayer: PacketDelayer;
        bDelayer: PacketDelayer;
    connections:
        aIn --> aDelayer.in;
        aDelayer.out --> aOut;
        bIn --> bDelayer.in;
        bDelayer.out --> bOut;
}

network TestNetwork
{
    submodules:
        source: TestHost;
        destination: TestHost;
        cable: TestCable;
    connections:
        source.lowerOut --> cable.aIn;
        cable.aOut --> destination.lowerIn;
        destination.lowerOut --> cable.bIn;
        cable.bOut --> source.lowerIn;
}

%inifile: omnetpp.ini

[General]
network = TestNetwork
sim-time-limit = 10s
cmdenv-event-banners = false
cmdenv-log-prefix = "At %ts %N: "
*.*.sourceApplication.packetLength = 1B
*.*.sourceApplication.productionInterval = uniform(0s, 2s)
*.*.mac.server.processingTime = uniform(0s, 2s)
*.cable.*Delayer.delay = uniform(0s, 2s)

%# remove formatting
%subst: /\x1B\[[0-9;]*m//

%subst: /\nRunning simulation\.\.\.\n//

%contains-regex: stdout
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-0[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-0[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-0[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-0)[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-0[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-0[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-0[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-0)[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-1[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-1[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-0)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-0[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-1[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-1)[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-1[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-1[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-0)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-0[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-1[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-1)[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-1)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-1[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-2[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-2[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-2[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-2)[^\n]*?
At [^\n]*?: Consuming packet, [^\n]*?sourceApplication-0[^\n]*?
At [^\n]*?: Consuming packet, [^\n]*?sourceApplication-0[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-1)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-1[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-3[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-3[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-2[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-2[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-2[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-2)[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-2)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-2[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-3[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-3)[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-3[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-3[^\n]*?
At [^\n]*?: Consuming packet, [^\n]*?sourceApplication-1[^\n]*?
At [^\n]*?: Consuming packet, [^\n]*?sourceApplication-1[^\n]*?
At [^\n]*?: Consuming packet, [^\n]*?sourceApplication-2[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-3)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-3[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-4[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-4[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-4[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-4[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-4[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-4)[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-2)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-2[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-3[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-3)[^\n]*?
At [^\n]*?: Consuming packet, [^\n]*?sourceApplication-3[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-4)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-4[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-5[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-5[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-3)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-3[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-4[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-4)[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-5[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-5[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-5[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-5)[^\n]*?
At [^\n]*?: Consuming packet, [^\n]*?sourceApplication-3[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-6[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-6[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-7[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-7[^\n]*?
At [^\n]*?: Consuming packet, [^\n]*?sourceApplication-2[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-4)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-4[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-5[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-5)[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-8[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-8[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-5)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-5[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-6[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-6)[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-6[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-6[^\n]*?
At [^\n]*?: Consuming packet, [^\n]*?sourceApplication-5[^\n]*?
At [^\n]*?: Consuming packet, [^\n]*?sourceApplication-4[^\n]*?
At [^\n]*?: Consuming packet, [^\n]*?sourceApplication-4[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-9[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-9[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-5)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-5[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-6[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-6)[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-6)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-6[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-7[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-7)[^\n]*?
At [^\n]*?: Producing packet, [^\n]*?sourceApplication-7[^\n]*?
At [^\n]*?: Pushing packet, [^\n]*?sourceApplication-7[^\n]*?
At [^\n]*?: Consuming packet, [^\n]*?sourceApplication-5[^\n]*?
At [^\n]*?: Processing packet ended, ([^\n]*?sourceApplication-7)[^\n]*?
At [^\n]*?: Delaying packet, [^\n]*?sourceApplication-7[^\n]*?
At [^\n]*?: Pulling packet, [^\n]*?sourceApplication-8[^\n]*?
At [^\n]*?: Processing packet started, ([^\n]*?sourceApplication-8)[^\n]*?

<!> Simulation time limit reached -- at t=10s
