%description:

In this test, packets are collected periodically by an active packet sink
(ActivePacketSink). The packets are produced by two active packet sources
(ActivePacketSources). The sources are connected to FIFO queues (PacketQueue)
where packets are stored temporarily. The single sink is connected to the
queues using a scheduler (PriorityScheduler). The scheduler forwards packets
from the queues to the sink in a prioritized way.

%file: test.ned

import inet.queueing.sink.ActivePacketSink;
import inet.queueing.queue.PacketQueue;
import inet.queueing.scheduler.PriorityScheduler;
import inet.queueing.source.ActivePacketSource;

network TestPriorityScheduler
{
    submodules:
        producer1: ActivePacketSource {
            @display("p=100,100");
        }
        producer2: ActivePacketSource {
            @display("p=100,200");
        }
        queue1: PacketQueue {
            @display("p=200,100");
        }
        queue2: PacketQueue {
            @display("p=200,200");
        }
        scheduler: PriorityScheduler {
            @display("p=300,100");
        }
        collector: ActivePacketSink {
            @display("p=400,100");
        }
    connections allowunconnected:
        producer1.out --> queue1.in;
        producer2.out --> queue2.in;
        queue1.out --> scheduler.in++;
        queue2.out --> scheduler.in++;
        scheduler.out --> collector.in;
}

%inifile: omnetpp.ini

[General]
network = TestPriorityScheduler
sim-time-limit = 10s
cmdenv-event-banners = false
cmdenv-log-prefix = "At %ts %N: "
*.producer*.packetLength = 1B
*.producer*.productionInterval = uniform(0s, 2s)
*.collector.collectionInterval = uniform(0s, 1s)

%# remove formatting
%subst: /\x1B\[[0-9;]*m//

%subst: /\nRunning simulation\.\.\.\n//

%contains-regex: stdout
At [^\n]*?: Pulling packet, .*?producer2-0.*?
At [^\n]*?: Scheduling packet, .*?producer2-0.*?
At [^\n]*?: Collecting packet, .*?producer2-0.*?
At [^\n]*?: Producing packet, .*?producer1-1.*?
At [^\n]*?: Pushing packet, .*?producer1-1.*?
At [^\n]*?: Producing packet, .*?producer2-1.*?
At [^\n]*?: Pushing packet, .*?producer2-1.*?
At [^\n]*?: Pulling packet, .*?producer1-1.*?
At [^\n]*?: Scheduling packet, .*?producer1-1.*?
At [^\n]*?: Collecting packet, .*?producer1-1.*?
At [^\n]*?: Pulling packet, .*?producer2-1.*?
At [^\n]*?: Scheduling packet, .*?producer2-1.*?
At [^\n]*?: Collecting packet, .*?producer2-1.*?
At [^\n]*?: Producing packet, .*?producer1-2.*?
At [^\n]*?: Pushing packet, .*?producer1-2.*?
At [^\n]*?: Pulling packet, .*?producer1-2.*?
At [^\n]*?: Scheduling packet, .*?producer1-2.*?
At [^\n]*?: Collecting packet, .*?producer1-2.*?
At [^\n]*?: Producing packet, .*?producer2-2.*?
At [^\n]*?: Pushing packet, .*?producer2-2.*?
At [^\n]*?: Producing packet, .*?producer1-3.*?
At [^\n]*?: Pushing packet, .*?producer1-3.*?
At [^\n]*?: Pulling packet, .*?producer1-3.*?
At [^\n]*?: Scheduling packet, .*?producer1-3.*?
At [^\n]*?: Collecting packet, .*?producer1-3.*?
At [^\n]*?: Pulling packet, .*?producer2-2.*?
At [^\n]*?: Scheduling packet, .*?producer2-2.*?
At [^\n]*?: Collecting packet, .*?producer2-2.*?
At [^\n]*?: Producing packet, .*?producer1-4.*?
At [^\n]*?: Pushing packet, .*?producer1-4.*?
At [^\n]*?: Pulling packet, .*?producer1-4.*?
At [^\n]*?: Scheduling packet, .*?producer1-4.*?
At [^\n]*?: Collecting packet, .*?producer1-4.*?
At [^\n]*?: Producing packet, .*?producer2-3.*?
At [^\n]*?: Pushing packet, .*?producer2-3.*?
At [^\n]*?: Pulling packet, .*?producer2-3.*?
At [^\n]*?: Scheduling packet, .*?producer2-3.*?
At [^\n]*?: Collecting packet, .*?producer2-3.*?
At [^\n]*?: Producing packet, .*?producer1-5.*?
At [^\n]*?: Pushing packet, .*?producer1-5.*?
At [^\n]*?: Pulling packet, .*?producer1-5.*?
At [^\n]*?: Scheduling packet, .*?producer1-5.*?
At [^\n]*?: Collecting packet, .*?producer1-5.*?
At [^\n]*?: Producing packet, .*?producer2-4.*?
At [^\n]*?: Pushing packet, .*?producer2-4.*?
At [^\n]*?: Pulling packet, .*?producer2-4.*?
At [^\n]*?: Scheduling packet, .*?producer2-4.*?
At [^\n]*?: Collecting packet, .*?producer2-4.*?
At [^\n]*?: Producing packet, .*?producer1-6.*?
At [^\n]*?: Pushing packet, .*?producer1-6.*?
At [^\n]*?: Pulling packet, .*?producer1-6.*?
At [^\n]*?: Scheduling packet, .*?producer1-6.*?
At [^\n]*?: Collecting packet, .*?producer1-6.*?
At [^\n]*?: Producing packet, .*?producer1-7.*?
At [^\n]*?: Pushing packet, .*?producer1-7.*?
At [^\n]*?: Pulling packet, .*?producer1-7.*?
At [^\n]*?: Scheduling packet, .*?producer1-7.*?
At [^\n]*?: Collecting packet, .*?producer1-7.*?
At [^\n]*?: Producing packet, .*?producer2-5.*?
At [^\n]*?: Pushing packet, .*?producer2-5.*?
At [^\n]*?: Pulling packet, .*?producer2-5.*?
At [^\n]*?: Scheduling packet, .*?producer2-5.*?
At [^\n]*?: Collecting packet, .*?producer2-5.*?
At [^\n]*?: Producing packet, .*?producer1-8.*?
At [^\n]*?: Pushing packet, .*?producer1-8.*?
At [^\n]*?: Producing packet, .*?producer1-9.*?
At [^\n]*?: Pushing packet, .*?producer1-9.*?
At [^\n]*?: Pulling packet, .*?producer1-8.*?
At [^\n]*?: Scheduling packet, .*?producer1-8.*?
At [^\n]*?: Collecting packet, .*?producer1-8.*?
At [^\n]*?: Pulling packet, .*?producer1-9.*?
At [^\n]*?: Scheduling packet, .*?producer1-9.*?
At [^\n]*?: Collecting packet, .*?producer1-9.*?
At [^\n]*?: Producing packet, .*?producer1-10.*?
At [^\n]*?: Pushing packet, .*?producer1-10.*?
At [^\n]*?: Producing packet, .*?producer1-11.*?
At [^\n]*?: Pushing packet, .*?producer1-11.*?
At [^\n]*?: Pulling packet, .*?producer1-10.*?
At [^\n]*?: Scheduling packet, .*?producer1-10.*?
At [^\n]*?: Collecting packet, .*?producer1-10.*?
At [^\n]*?: Producing packet, .*?producer2-6.*?
At [^\n]*?: Pushing packet, .*?producer2-6.*?
